# AI Fitness Coach

## 1. Project Overview / Technical Description

The AI Fitness Coach is a mobile application designed to provide users with personalized fitness and diet plans. Users can sign up, provide their fitness goals and preferences via a survey, and receive a tailored weekly plan generated by an Artificial Intelligence Large Language Model. The application also allows users to track their workout progress and manage their account.

### Key Technologies:

- Frontend: React Native (Mobile Application)
- Backend API: Node.js with Express.js
- Database: MongoDB
- AI Service: Google Gemini API (Large Language Model)

## 2. Architecture Overview

### 2.1. High-Level Architecture Description

The system follows a microservice-oriented architecture with distinct components interacting through APIs.

- **React Native Client**: The user-facing mobile application where users interact with the system. It sends requests to and receives responses from the Backend API.
- **Node.js/Express.js Backend API**: The central hub for business logic, data persistence, and communication with external services. It works with Firebase Authentication for user authentication and authorization, manages data (storing user profiles, fitness plans, and progress), and orchestrates requests to the Gemini API.
- **MongoDB**: The NoSQL document database used for persistent storage of all application data, including user credentials, profiles, generated fitness plans, and workout progress.
- **Gemini API (LLM Service)**: An external AI service responsible for processing user survey data and generating personalized fitness and diet plans.

### 2.2. Technology Stack

- Frontend Framework: React Native
- Backend Runtime: Node.js
- Backend Web Framework: Express.js
- Authentication: Firebase Authentication
- Database System: MongoDB
- AI Model: Google Gemini API
- Communication Protocol: HTTP/HTTPS (RESTful APIs)
- Data Format: JSON

## 3. Database Schema

### 3.1. `users` Collection Schema

This collection stores core user information, including authentication details and survey responses.

```javascript
// users collection
{
  "_id": "<ObjectId>", // MongoDB document ID
  "firebaseUserId": "<String>", // Unique identifier for the user from Firebase Auth
  "userInfo": {      // Stores user information.
    "firstName": "<String>",
    "lastName": "<String>",
    "email": "<String>" // Should match the email used in Firebase Auth
  },
  "profile": {          // Stores user's personal and preference data from the survey.
    "personalGoalsExperience": {
      "primaryFitnessGoal": "<String>",
      "currentWeightLbs": "<Number>",
      "desiredWeightLbs": "<Number>",
      "heightCms": "<Number>",
      "currentFitnessLevel": "<String>",
      "ageGroup": "<String>"
    },
    "scheduleAvailability": {
      "daysPerWeekWorkout": "<String>",
      "preferredWorkoutTimes": "<String>"
    },
    "equipmentAccess": {
      "equipment": ,
      "location": "<String>"
    },
    "dietaryPreferences": {
      "primaryDietaryPreference": "<String>",
      "restrictionsAllergies":
    },
    "healthConsiderations": {
      "medicalConditions": "<String>",
      "workoutsToAvoid":
    },
    "preferencesMotivation": {
      "enjoyedWorkoutTypes":
    }
  },
  "createdAt": "<Date>", // Timestamp for user creation.
  "updatedAt": "<Date>"  // Timestamp for last profile update.
}
```

### 3.2. `fitnessPlans` Collection Schema

This collection stores individual fitness and diet plans generated for users, along with progress tracking.

```javascript
// fitnessPlans collection
{
  "_id": "<ObjectId>",      // Unique identifier for this fitness plan document.
  "userId": "<ObjectId>",   // References the user associated with this plan.
  "generatedPlan": {        // The AI-generated workout and diet schedule.
    "weekly_plan": {
      "monday": {
        "workout": {
          "type": "<String>",
          "duration_minutes": "<Number>",
          "exercises": [
            {
              "name": "<String>",
              "sets": "<String>",
              "reps": "<String>",
              "notes": "<String>"
            }
          ],
          "notes": "<String>"
        },
        "diet": {
          "daily_notes": "<String>",
          "estimated_calories": "<Number>",
          "macronutrient_summary": {
            "protein_grams": "<Number>",
            "carbs_grams": "<Number>",
            "fat_grams": "<Number>"
          },
          "meals_list": [
            {
              "meal_type": "<String>",
              "description": "<String>"
            }
          ]
        }
      },
      "tuesday": { /* ... similar structure for other days ... */ },
      "wednesday": { /* ... */ },
      "thursday": { /* ... */ },
      "friday": { /* ... */ },
      "saturday": { /* ... */ },
      "sunday": { /* ... */ }
    },
    "general_notes": "<String>" // Any overall tips or disclaimers for the plan.
  },
  "progress": ,   // A list of dates when the user marked *any* progress (e.g., completed a workout/meal for that day).
  "createdAt": "<Date>",    // Timestamp for when this plan was generated/created.
  "updatedAt": "<Date>"     // Timestamp for last update to the plan or progress.
}
```

## 4. User Interaction Flows

These flows detail the sequence of user actions and system responses.

### 4.1. User Onboarding & Personalized Plan Creation

**Description**: The process from a new user signing up to receiving and confirming their initial personalized fitness and diet plan.

**Steps**:

1.  **User Initiates Onboarding**: The user fills out a survey and provides account details on the React Native front-end.
2.  **Firebase Authentication**: The front-end calls Firebase Auth using email and password to create a new user account and obtains an authentication token.
3.  **Submit User Profile & Survey**: The front-end sends an HTTP POST request to `/api/users/onboarding` with the Firebase token and survey data.
4.  **Process User Onboarding**: The back-end verifies the Firebase token, extracts the userId, and saves the user information and profile data to the `users` collection in MongoDB.
5.  **Generate Personalized Plan**: The back-end calls the Gemini API (via `generateGeminiContent`) with the user's profile data to generate a personalized workout/diet plan as JSON.
6.  **Store & Deliver Plan**: The back-end inserts the JSON plan into the `fitnessPlans` collection and sends a response with both the user object and fitness plan to the front-end.
7.  **Display Plan to User**: The front-end renders the workout and diet plan in a calendar format for the user.
8.  **User Confirms or Regenerates Plan**: The user either confirms the displayed plan or clicks to regenerate a new plan, which directly triggers a re-request to the Gemini API (steps 5-7) using their existing profile.

### 4.2. User Authentication & Session Management

**Description**: How existing users securely authenticate and access their personalized data within the application.

**Steps**:

1.  **User Enters Credentials**: The user provides their email and password in the login screen of the React Native app.
2.  **Firebase Authentication**: The front-end authenticates with Firebase Auth services, which validates the credentials and returns an authentication token upon successful verification.
3.  **Token Storage**: The app securely stores the authentication token in the device's secure storage for persistent sessions.
4.  **Initial Data Retrieval**: The app immediately calls the `/api/users/signin` endpoint with the Firebase token in the Authorization header (Bearer scheme) to retrieve the user's profile and current fitness plan in a single request.
5.  **Data Initialization**: Upon receiving the response containing both the user object and fitness plan, the app initializes the user's session state with their personalized data.
6.  **Authenticated API Requests**: For all subsequent requests to protected endpoints, the app includes the token in the Authorization header using the Bearer scheme.
7.  **Token Verification**: The AI Fitness API validates the Firebase token on each request using the authMiddleware before granting access to protected resources.
8.  **Session Management**: The app monitors token expiration and automatically refreshes it when needed to maintain the user session.
9.  **Secure Logout**: When the user logs out, the app clears the stored token and notifies Firebase Auth to invalidate the session.

### 4.3. Track Workout Completion

**Description**: How a user marks a workout as completed and updates their progress.

**Steps**:

1.  **User Marks Workout Complete**: The user marks a workout as completed for a given day in the front-end.
2.  **Submit Workout Completion**: The front-end sends an HTTP request to the back-end to record the completion.
3.  **Record Progress**: The back-end adds the completion date to the `progress` list within the user's current `fitnessPlans` document in MongoDB.
4.  **Confirm Update**: The back-end sends a success response to the front-end.
5.  **Display Confirmation**: The front-end visually updates the completed workout.

### 4.4. User Account Deletion

**Description**: The process of a user permanently deleting their account and associated data.

**Steps**:

1.  **User Initiates Deletion**: The user confirms account deletion on the profile page.
2.  **Request Account Deletion**: The front-end sends an HTTP request to the back-end to delete the account.
3.  **Process Account Deletion**: The back-end deletes the user's data from both the `users` and `fitnessPlans` collections in MongoDB.
4.  **Confirm Deletion**: The back-end sends a success response to the front-end.
5.  **User Notification & Logout**: The user is logged out, and a confirmation message is displayed.

## 5. Conclusion

This document provides a foundational technical design for the AI Fitness Coach application, outlining its architecture, database schemas, and core user interaction flows. This will serve as a valuable reference for the development team in implementing the system.
